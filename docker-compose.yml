services:
  edumeet-bundle:
    env_file: .env
    restart: unless-stopped
    volumes:
      - './configs/server:/app/config'
      - './docker-entrypoint.sh:/entrypoint.sh'
      - ./configs/proxy:/etc/nginx/sites-enabled
      - ./certs:/etc/edumeet/certs
    container_name: edumeet-bundle
    build:
      args:
        - 'GIT_SERVER=${GIT_SERVER}'
        - 'REPOSITORY=${REPOSITORY}'
        - 'EDUMEET_SERVER=${EDUMEET_SERVER}'
        - 'BRANCH_SERVER=${BRANCH_SERVER}'
        - 'EDUMEET_CLIENT=${EDUMEET_CLIENT}'
        - 'BRANCH_CLIENT=${BRANCH_CLIENT}'
        - 'EDUMEET_MN_SERVER=${EDUMEET_MN_SERVER}'
        - 'BRANCH_MN_SERVER=${BRANCH_MN_SERVER}'
        - 'LISTEN_IP=${LISTEN_IP}'
        - 'MN_EXTRA_PARAMS=${MN_EXTRA_PARAMS}'
      context: .
      dockerfile: Dockerfiles/Dockerfile-edumeet-bundle
    image: '${REPOSITORY}/edumeet-bundle:${TAG}'
    command: >
      DEBUG=*
      --listenPort ${LISTEN_PORT}
      --rtcMinPort ${RTC_MIN_PORT}
      --rtcMaxPort ${RTC_MAX_PORT}
      --ip ${LISTEN_IP}
      --secret ${MEDIA_SECRET} 
      --announcedIp ${EXTERNAL_IP}
    security_opt:
      - seccomp:unconfined
    network_mode: "host"